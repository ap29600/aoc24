(m;d):"\n"\'"\n\n"\1:"15.txt"
(h;w):#'1*:\m
m1:,/m
m2:,/("#O.@"!("##";"[]";"..";"@."))@m1

H:{ b:y@-1_i:(|/"O[]"=\:y@)(x+)\x+z
    $["#"=y@*|i;(y;z);(@[y;(0,x)+\:-1_i;:;(".";b)];x+z)]}

V:{ b:y@i:,/-1_(#:)(?,//(0 1;0 -1)+\:'@/1(&'"[]"=\:y@)\x+)\,z
    $[0|/"#"=y@x+i;(y;z);(@[y;(0,x)+\:i;:;(".";b)];x+z)]}

GPS: {+//((100*!#x)+\:!#*x)*x}
GPS (h;  w)#"O"=*(m1;*&m1="@"){y .x}/("<>^v"!H@'-1 1,-1 1*w)@,/d
GPS (h;2*w)#"["=*(m2;*&m2="@"){y .x}/("<>^v"!,/(H;V)@/:'(-1 1;-2 2*w))@,/d


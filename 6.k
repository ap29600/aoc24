j:(0 0 -1 -1+,/|:'\2#,!1+#m)@'(4-!4)(|+:)/'{(-1+&x,0 1)@+\x}''3(|+:)\"#"=m:0:"6.txt"
b:&/0=(0,#m)'
start:,/&"^"=m
s:{$[~b x;(x;y);(@[x;2!1+y;:;z .y,x];4!1+y)]}
p:*'(b@*:)(s[;;j].)\(start;3)
t:{+x+(!+/{x|-x}d)*/:0 1'd:y-x}
#w:!=,/t'/-1 1_\:p
up:{{x(.[;;:;y])/(~b')_z}'[j;-1 -1 1 1+x 1 0 1 0;t[;x]'1 0 1 0 .[x;;:;]'(,/|0 2_j).\:x]}
+/{b@**{(~~/)((x.;x. x.)@')/(y;x. y)}[s[;;up x];(start;3)]}'w^,start

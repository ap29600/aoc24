(a;b;p):+'+`I${", Y"\1_*|": "\x^"+="}''3#'0N 4#0:"13.txt"
D:{(y&-y)!''x*0 1'y}
s:{na:|/D[z-y*\:nb:D/(z;y)(+/*)\:-1 1*|x;x]
   +/(nb+3*na)*(&/z=+/(x;y)*\:'(na;nb))&~(na<0)|nb<0}
s[a;b;p]
s[a;b;p+*/13#10]

in:" ",'0:"4.txt"
r:+/((#*in),1)*
+//&/"MAS"=(,/in)@(r(-1+!3 3)*/:\:1+!3)+\:\:r@&in="X"
+/|/&/'("MMSS";"MSMS";"SSMM";"SMSM")=\:(,/in)@(r -1+2*!2 2)+\:r@&in="A"

/ sh:{0^,/(x_y;x#0#y)@<0,x}
/ shm:{$[1<#x;o/:[1_x;sh[*x;y]];sh[*x;y]]}
/ 
/ +//&/'((+-1+!3 3)_4){(x*/:!4)shm'y}\:(X;M;A;S):"XMAS"=\:in
/ +//A&&/{|/|/&/'+:\2 2#x}'(+-1+2*!2 2)shm\:/:(M;S)

